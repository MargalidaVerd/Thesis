<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Margalida Verd Julià">

<title>TFG</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TFG_files/libs/clipboard/clipboard.min.js"></script>
<script src="TFG_files/libs/quarto-html/quarto.js"></script>
<script src="TFG_files/libs/quarto-html/popper.min.js"></script>
<script src="TFG_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TFG_files/libs/quarto-html/anchor.min.js"></script>
<link href="TFG_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TFG_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TFG_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TFG_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TFG_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TFG</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Margalida Verd Julià </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="installing-data-and-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-data-and-packages">Installing data and packages</h2>
<p>First, we will install and load the necessary packages for this study. Additionally, we will load the required datasets. The analysis is based on three datasets:</p>
<ul>
<li><p><strong>Mortality</strong>: Downloaded from the World Health Organization, this is the primary dataset for the analysis. It contains the number of tuberculosis-related deaths in all countries. However, our study will focus solely on European countries.</p></li>
<li><p><strong>Population</strong>: From this dataset, we will extract only the population variable. The source of this data is <em>Our World in Data</em>.</p></li>
<li><p><strong>GDP per capita</strong>: Similar to the population dataset, we will extract only the <em>gdp_per_capita</em> variable. The source of this data is <em>Data Bank</em>.</p></li>
</ul>
<p>Let’s examine the structure of the datasets:</p>
<ol type="1">
<li>Mortality:</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 14,692
Columns: 12
$ Region.Code                                                 &lt;chr&gt; "EU", "EU"…
$ Region.Name                                                 &lt;chr&gt; "Europe", …
$ Country.Code                                                &lt;chr&gt; "ALB", "AL…
$ Country.Name                                                &lt;chr&gt; "Albania",…
$ Year                                                        &lt;dbl&gt; 1987, 1997…
$ Sex                                                         &lt;chr&gt; "All", "Al…
$ Age.group.code                                              &lt;chr&gt; "Age_all",…
$ Age.Group                                                   &lt;chr&gt; "[All]", "…
$ Number                                                      &lt;dbl&gt; 47, 19, 10…
$ Percentage.of.cause.specific.deaths.out.of.total.deaths     &lt;dbl&gt; 0.27126861…
$ Age.standardized.death.rate.per.100.000.standard.population &lt;dbl&gt; 2.2548644,…
$ Death.rate.per.100.000.population                           &lt;dbl&gt; 1.5279087,…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Age_all"</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Population</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18,944
Columns: 3
$ Entity                                                &lt;chr&gt; "Afghanistan", "…
$ Year                                                  &lt;int&gt; 1950, 1951, 1952…
$ Population...Sex..all...Age..all...Variant..estimates &lt;dbl&gt; 7776182, 7879343…</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>gdp_per_capita</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,629
Columns: 7
$ Series.Name  &lt;chr&gt; "GDP per capita (current US$)", "GDP per capita (current …
$ Series.Code  &lt;chr&gt; "NY.GDP.PCAP.CD", "NY.GDP.PCAP.CD", "NY.GDP.PCAP.CD", "NY…
$ Country.Name &lt;chr&gt; "Albania", "Albania", "Albania", "Albania", "Albania", "A…
$ Country.Code &lt;chr&gt; "ALB", "ALB", "ALB", "ALB", "ALB", "ALB", "ALB", "ALB", "…
$ Time         &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 196…
$ Time.Code    &lt;chr&gt; "YR1960", "YR1961", "YR1962", "YR1963", "YR1964", "YR1965…
$ Value        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
</div>
</div>
</section>
<section id="cleaning-data" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-data">Cleaning data</h2>
<p>As seen, we need to standardize the variables names to merge the tables.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mortality"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 14,692
Columns: 12
$ region_code                       &lt;chr&gt; "EU", "EU", "EU", "EU", "EU", "EU", …
$ region_name                       &lt;chr&gt; "Europe", "Europe", "Europe", "Europ…
$ country_code                      &lt;chr&gt; "ALB", "ALB", "ALB", "ALB", "ALB", "…
$ country_name                      &lt;chr&gt; "Albania", "Albania", "Albania", "Al…
$ year                              &lt;dbl&gt; 1987, 1997, 1996, 1996, 1995, 1994, …
$ Sex                               &lt;chr&gt; "All", "All", "Female", "All", "Male…
$ Age.group.code                    &lt;chr&gt; "Age_all", "Age_all", "Age_all", "Ag…
$ Age.Group                         &lt;chr&gt; "[All]", "[All]", "[All]", "[All]", …
$ number_deaths                     &lt;dbl&gt; 47, 19, 10, 34, 10, 13, 26, 39, 12, …
$ percent_cause_specific_death_rate &lt;dbl&gt; 0.27126861, 0.11741441, 0.14432097, …
$ age_death_rate                    &lt;dbl&gt; 2.2548644, 0.8057827, 0.7155687, 1.1…
$ death_rate                        &lt;dbl&gt; 1.5279087, 0.5715489, 0.6027727, 1.0…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Population"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18,944
Columns: 3
$ country_name &lt;chr&gt; "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan…
$ year         &lt;int&gt; 1950, 1951, 1952, 1953, 1954, 1955, 1956, 1957, 1958, 195…
$ population   &lt;dbl&gt; 7776182, 7879343, 7987783, 8096703, 8207953, 8326981, 845…</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gdp_per_capita"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,629
Columns: 4
$ country_name &lt;chr&gt; "Albania", "Albania", "Albania", "Albania", "Albania", "A…
$ country_code &lt;chr&gt; "ALB", "ALB", "ALB", "ALB", "ALB", "ALB", "ALB", "ALB", "…
$ year         &lt;int&gt; 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 196…
$ gdp_capita   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
</div>
</div>
<p>The next step is to select the study variables from the mortality dataset. We will exclude <code>Sex</code>, <code>Age.group.code</code> and <code>Age.group</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,869
Columns: 9
$ region_code                       &lt;chr&gt; "EU", "EU", "EU", "EU", "EU", "EU", …
$ region_name                       &lt;chr&gt; "Europe", "Europe", "Europe", "Europ…
$ country_code                      &lt;chr&gt; "ALB", "ALB", "ALB", "ALB", "ALB", "…
$ country_name                      &lt;chr&gt; "Albania", "Albania", "Albania", "Al…
$ year                              &lt;dbl&gt; 1987, 1997, 1996, 1994, 1992, 1989, …
$ number_deaths                     &lt;dbl&gt; 47, 19, 34, 39, 22, 41, 39, 17, 34, …
$ percent_cause_specific_death_rate &lt;dbl&gt; 0.27126861, 0.11741441, 0.20302144, …
$ age_death_rate                    &lt;dbl&gt; 2.2548644, 0.8057827, 1.1585865, 1.5…
$ death_rate                        &lt;dbl&gt; 1.5279087, 0.5715489, 1.0356381, 1.2…</code></pre>
</div>
</div>
<p>Now, we can merge the remaining two datasets.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,998
Columns: 11
$ region_code                       &lt;chr&gt; "EU", "EU", "EU", "EU", "EU", "EU", …
$ region_name                       &lt;chr&gt; "Europe", "Europe", "Europe", "Europ…
$ country_code                      &lt;chr&gt; "ALB", "ALB", "ALB", "ALB", "ALB", "…
$ country_name                      &lt;chr&gt; "Albania", "Albania", "Albania", "Al…
$ year                              &lt;dbl&gt; 1987, 1997, 1996, 1994, 1992, 1989, …
$ number_deaths                     &lt;dbl&gt; 47, 19, 34, 39, 22, 41, 39, 17, 34, …
$ percent_cause_specific_death_rate &lt;dbl&gt; 0.27126861, 0.11741441, 0.20302144, …
$ age_death_rate                    &lt;dbl&gt; 2.2548644, 0.8057827, 1.1585865, 1.5…
$ death_rate                        &lt;dbl&gt; 1.5279087, 0.5715489, 1.0356381, 1.2…
$ population                        &lt;dbl&gt; 3148843, 3229665, 3245681, 3269417, …
$ gdp_capita                        &lt;dbl&gt; 674.7934, 717.3800, 1009.9771, 586.4…</code></pre>
</div>
</div>
</section>
<section id="chosen-countries" class="level2">
<h2 class="anchored" data-anchor-id="chosen-countries">Chosen countries</h2>
<p>First, we will define the criteria for dividing European countries into six distinct regions: North, South, West, East, Central, and the Balkans. The Balkans have been designated as a separate region due to their significant cultural differences from neighboring countries. We will add a new variable to the dataset that specifies the subregion to which each country belongs.</p>
<p>The map below shows the division that would be used from this point forward.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We are considering Greece as part of the Southern region due to the cultural differences with the Balkan countries. Now, we would choose a country to represent each European subregion. We will select five European countries to analyze their trends in the number of tuberculosis-related deaths. The selection criteria will ensure that the chosen countries represent different regions of Europe (e.g., North, South, etc.) while also having a sufficient number of time observations to construct a reliable time series. Additionally, we aim to include countries that exhibit distinct trends in tuberculosis mortality, making the study more insightful by allowing for a comparative analysis and accurate forecasting of different patterns.</p>
<p>As a first step, we will address any missing values (NA) in the dataset for the variable Number_Deaths in each selected country. We are going to choose countries that at least have 40 years with data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                                           country_name  n
1                                           Netherlands 73
2                                               Iceland 72
3                                                Sweden 72
4                                               Denmark 71
5                                                France 71
6                                               Ireland 71
7                                                 Spain 71
8                                           Switzerland 71
9  United Kingdom of Great Britain and Northern Ireland 71
10                                              Finland 70
11                                                Italy 70
12                                              Hungary 68
13                                              Austria 67
14                                              Belgium 67
15                                               Norway 66
16                                             Portugal 62
17                                               Poland 61
18                                               Greece 60
19                                              Romania 60
20                                             Bulgaria 58
21                                           Luxembourg 56
22                                                Malta 55
23                                               Latvia 42
24                                              Estonia 40
25                                            Lithuania 40
26                                   Russian Federation 40</code></pre>
</div>
</div>
<p>Lets study each subregion:</p>
<ul>
<li><p><strong>Southern Europe</strong>. Due to the geographical origin of the authors, we will choose Spain as the representative country of this region.</p></li>
<li><p><strong>Northern Europe</strong>. We observe that Iceland has 72 out of 74 years with recorded values for the selected variable, making it a suitable choice to represent the North region of Europe.</p></li>
<li><p><strong>Western Europe</strong>. As Netherlands is the country with a greatest number of values, it would be our choice for this specific region.</p></li>
<li><p><strong>Eastern Europe</strong>. It is noticeable that eastern countries are the ones with a less number of recorded values (most of them have only 40 or less); then, it would be a special region to analyse. Lithuania will represent the Northeast region, with 40 recorded values. Even though there are nearby countries with longer recorded periods, the tendency of Lithuania stands out among the rest, which will make for an interesting analysis.</p></li>
<li><p><strong>Central Europe</strong>. Switzerland will be the representative country of the central region. It has 71 recorded values, that will fit perfectly when modeling the time series.</p></li>
<li><p><strong>Balkans region</strong>. For the Balkans region, we have selected Romania, which has 60 recorded values. It will be an interesting case of analysis due to its tendency, that is a bit different as the other countries.</p></li>
</ul>
<p>The selection criteria prioritize minimizing the number of missing values (NA) while ensuring a diverse representation of different regions in Europe. As we have discussed trends, let’s display the trend in tuberculosis-related deaths for the selected countries.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_spain <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Spain"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths)) <span class="sc">+</span>  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Spain"</span> ) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plot_sweden <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Sweden"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths)) <span class="sc">+</span>  </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sweden"</span>, <span class="at">y =</span> <span class="st">"Number of deaths"</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>plot_netherlands <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Netherlands"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths)) <span class="sc">+</span>  </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Netherlands"</span>, <span class="at">y =</span> <span class="st">"Number of deaths"</span>) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>plot_romania <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Romania"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths)) <span class="sc">+</span>  </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Romania"</span>, <span class="at">y =</span> <span class="st">"Number of deaths"</span>) <span class="sc">+</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>plot_latvia <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Latvia"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths)) <span class="sc">+</span>  </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Latvia"</span>, <span class="at">y =</span> <span class="st">"Number of deaths"</span>) <span class="sc">+</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>plot_switzerland <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Switzerland"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths)) <span class="sc">+</span>  </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Switzerland"</span>, <span class="at">y =</span> <span class="st">"Number of deaths"</span>) <span class="sc">+</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>plot_spain</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plot_switzerland</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plot_sweden</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_latvia</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plot_romania</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>plot_netherlands</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  plot_spain, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  plot_switzerland, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  plot_sweden, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  plot_latvia, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  plot_romania, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  plot_netherlands, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">top =</span> <span class="st">"TB mortality trends per country"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">bottom =</span> <span class="fu">textGrob</span>(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Year"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gp =</span> <span class="fu">gpar</span>( <span class="at">fontsize =</span> <span class="dv">10</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">left =</span> <span class="fu">textGrob</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Number of deaths"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">10</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">rot =</span> <span class="dv">90</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>  )</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-12-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="detrending-series" class="level2">
<h2 class="anchored" data-anchor-id="detrending-series">Detrending series</h2>
<p>In order to build accurate time series models, the data must be stationary—meaning it should exhibit constant mean and variance over time. Since developed countries (e.g., Spain, the Netherlands) show a strong downward trend in TB death counts over the years, we begin by transforming the original data using logarithms. This transformation stabilizes the variance and linearizes exponential trends, making the data more suitable for ARIMA modeling.</p>
<section id="spain" class="level3">
<h3 class="anchored" data-anchor-id="spain">Spain</h3>
<p>We start with the Spanish data:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s check the ACF and PACF of the series:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Upon inspecting the ACF and PACF plots, we observe a strong autocorrelation in the undifferenced series, particularly at lower lags. To remove this non-stationarity, we apply first-order differencing:</p>
<p>The resulting ACF and PACF plots indicate that autocorrelations have been adequately removed, and the series is now stationary:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We fit an ARIMA model automatically selected by auto.arima() from the forecast package, which chooses the best-fitting model based on information criteria (AICc by default):</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Series: log_spain_data 
ARIMA(0,1,0) with drift 

Coefficients:
        drift
      -0.0716
s.e.   0.0117

sigma^2 = 0.00969:  log likelihood = 63.47
AIC=-122.93   AICc=-122.75   BIC=-118.44</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,0) with drift
Q* = 2.1127, df = 10, p-value = 0.9954

Model df: 0.   Total lags used: 10</code></pre>
</div>
</div>
<p>To properly check the normality of the residuals, we do the Shapiro-Wilk test:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(fit_spain)
W = 0.90578, p-value = 5.889e-05</code></pre>
</div>
</div>
<p>The ARIMA model applied is the ARIMA(0,1,0), as it is the best suited fot the series. Residual diagnostics support this model. The Ljung-Box test yields a p-value of 0.9954, suggesting no significant autocorrelation in the residuals. However, the Shapiro-Wilk test for normality gave a p-value of 5.88×10⁻⁵, leading us to reject the null hypothesis of normality. This implies that while the model captures the time dependence effectively, the residuals deviate from normality. To account for this, bootstrapping was enabled during forecasting to generate more robust prediction intervals.</p>
<p>Setting bootstrap = TRUE enables the computation of prediction intervals using bootstrapped innovations rather than assuming normality. This is particularly useful when residuals show slight deviations from normality or the model is very sensitive to error structure. Bootstrapping provides more robust and possibly asymmetric confidence intervals. However, it also increases computational time.</p>
<p>Now, to forecast future values, we apply the <code>forecast()</code>function:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, we back-transform the forecasts to the original scale by applying the exponential function:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   year number_deaths exp_fitted
1  1951         26206 25938.8804
2  1952         15971 24394.3119
3  1953         11533 14866.8838
4  1954         10802 10735.6941
5  1955         10255 10055.2300
6  1956          9704  9546.0455
7  1957          9524  9033.1376
8  1958          8052  8865.5814
9  1959          7819  7495.3446
10 1960          7791  7278.4524
11 1961          7484  7252.3882
12 1962          7278  6966.6119
13 1963          6725  6774.8532
14 1964          6273  6260.0835
15 1965          5702  5839.3314
16 1966          5272  5307.8061
17 1967          4574  4907.5331
18 1968          4517  4257.7876
19 1969          4265  4204.7282
20 1970          3596  3970.1496
21 1971          3594  3347.3993
22 1972          3017  3345.5375
23 1973          2877  2808.4270
24 1974          2588  2678.1056
25 1975          2557  2409.0849
26 1976          2480  2380.2280
27 1977          2211  2308.5512
28 1978          2059  2058.1479
29 1979          1783  1916.6560
30 1980          1476  1659.7366
31 1981          1583  1373.9603
32 1982          1338  1473.5631
33 1983          1288  1245.5006
34 1984          1141  1198.9573
35 1985          1126  1062.1197
36 1986          1071  1048.1567
37 1987          1062   996.9590
38 1988           999   988.5812
39 1989           943   929.9366
40 1990           980   877.8080
41 1991           903   912.2501
42 1992           866   840.5733
43 1993           832   806.1312
44 1994           754   774.4817
45 1995           752   701.8740
46 1996           714   700.0123
47 1997           646   664.6393
48 1998           595   601.3404
49 1999           660   553.8661
50 2000           520   614.3725
51 2001           490   484.0511
52 2002           491   456.1250
53 2003           473   457.0559
54 2004           445   440.3003
55 2005           475   414.2360
56 2006           396   442.1620
57 2007           409   368.6235
58 2008           349   380.7248
59 2009           394   324.8727
60 2010           392   366.7618
61 2011           288   364.9000
62 2012           320   268.0898
63 2013           291   297.8776
64 2014           279   270.8824
65 2015           244   259.7120
66 2016           250   227.1317
67 2017           242   232.7169
68 2018           249   225.2699
69 2019           217   231.7860
70 2020           198   201.9982
71 2021           174   184.3118</code></pre>
</div>
</div>
<p>The fitted values and forecasts are then plotted alongside the original series to assess model performance:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To display the forecasts an their associated uncerainty, we prepare a data frame with the exponential of the forecast and confidence intervals:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  year     mean     lower    upper
1 2022 161.9709 125.63098 193.3054
2 2023 150.7735 104.04564 190.9305
3 2024 140.3501  93.07291 186.6975</code></pre>
</div>
</div>
<p>Finally, we visualize the forecasts:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ARIMA(0,1,0) model applied to the log-transformed TB death series for Spain captures the downward trend effectively, with residual diagnostics confirming no significant autocorrelation. However, the residuals deviate from normality, which was addressed using bootstrapped forecasts to provide more reliable prediction intervals. The fitted values closely track the actual data, and the short-term forecasts show a continued decline in TB deaths, with relatively narrow confidence intervals, reflecting stability in the trend. These results suggest that ARIMA(0,1,0) is a simple yet adequate model for capturing and forecasting TB mortality trends in Spain.</p>
</section>
<section id="netherlands" class="level3">
<h3 class="anchored" data-anchor-id="netherlands">Netherlands</h3>
<p>We now apply the same methodology to the Netherlands, a country that also shows a notable long-term decrease in TB deaths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>netherlands_data <span class="ot">&lt;-</span> chosen_countries <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">==</span> <span class="st">"Netherlands"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, number_deaths) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>netherlands_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year number_deaths
1  1950          1922
2  1951          1657
3  1952          1278
4  1953           966
5  1954           798
6  1955           717
7  1956           596
8  1957           515
9  1958           482
10 1959           414
11 1960           325
12 1961           316
13 1962           296
14 1963           251
15 1964           230
16 1965           222
17 1966           187
18 1967           176
19 1968           197
20 1969           167
21 1970           156
22 1971           209
23 1972           206
24 1973           190
25 1974           182
26 1975           199
27 1976           140
28 1977           101
29 1978           173
30 1979           177
31 1980           162
32 1981           178
33 1982           178
34 1983           161
35 1984           166
36 1985           138
37 1986           166
38 1987           157
39 1988           151
40 1989           162
41 1990           136
42 1991           120
43 1992           142
44 1993           172
45 1994           140
46 1995           138
47 1996           127
48 1997           105
49 1998           118
50 1999           120
51 2000            91
52 2001            87
53 2002            72
54 2003            72
55 2004            78
56 2005            70
57 2006            76
58 2007            54
59 2008            51
60 2009            62
61 2010            54
62 2011            36
63 2012            34
64 2013            38
65 2014            34
66 2015            36
67 2016            29
68 2017            23
69 2018            28
70 2019            20
71 2020            32
72 2021            20
73 2022            17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>vctsfr<span class="sc">::</span><span class="fu">plot_ts</span>(<span class="fu">ts</span>(netherlands_data<span class="sc">$</span>number_deaths, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1950</span>), <span class="at">frequency =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>log_netherlands_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">log</span>(netherlands_data<span class="sc">$</span>number_deaths), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1950</span>), <span class="at">frequency =</span> <span class="dv">1</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>vctsfr<span class="sc">::</span><span class="fu">plot_ts</span>(log_spain_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(log_netherlands_data)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(log_netherlands_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We difference the series once:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>log_netherlands_data_diff <span class="ot">&lt;-</span> log_netherlands_data <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>(<span class="at">differences =</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s check again the ACF and PACF:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(log_netherlands_data_diff)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(log_netherlands_data_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The ACF slowly shows a possible significant lag at <span class="math inline">\(t-1\)</span>. We will present two different models: ARIMA(0,1,0) and ARIMA(0,1,1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit_netherlands_model_1 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">auto.arima</span>(log_netherlands_data)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fit_netherlands_model_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: log_netherlands_data 
ARIMA(0,1,1) with drift 

Coefficients:
          ma1    drift
      -0.2800  -0.0644
s.e.   0.1136   0.0149

sigma^2 = 0.03116:  log likelihood = 23.68
AIC=-41.35   AICc=-41   BIC=-34.52</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fit_netherlands_model_1 <span class="sc">%&gt;%</span> forecast<span class="sc">::</span><span class="fu">checkresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1) with drift
Q* = 9.6993, df = 9, p-value = 0.3754

Model df: 1.   Total lags used: 10</code></pre>
</div>
</div>
<p>For the ARIMA(0,1,1) the residuals pass the LB test. Now, let’s see the residuals for the ARIMA(0,1,0):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fit_netherlands_model_2 <span class="ot">&lt;-</span> <span class="fu">arima</span>(log_netherlands_data, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fit_netherlands_model_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = log_netherlands_data, order = c(0, 1, 0))


sigma^2 estimated as 0.03678:  log likelihood = 16.74,  aic = -31.48</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fit_netherlands_model_2 <span class="sc">%&gt;%</span> forecast<span class="sc">::</span><span class="fu">checkresiduals</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,0)
Q* = 10.702, df = 10, p-value = 0.3812

Model df: 0.   Total lags used: 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(fit_netherlands_model_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(fit_netherlands_model_2)
W = 0.96646, p-value = 0.04899</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>forecasted_netherlands_1<span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_netherlands_model_1,<span class="at">level =</span> <span class="fu">c</span>(<span class="dv">95</span>), <span class="at">h=</span><span class="dv">3</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(forecasted_netherlands_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>exp_forecasted_netherlands_fitted_1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(forecasted_netherlands_1<span class="sc">$</span>fitted)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>data_netherlands_1 <span class="ot">&lt;-</span> netherlands_data <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exp_fitted =</span> exp_forecasted_netherlands_fitted_1) </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>data_netherlands_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year number_deaths exp_fitted
1  1950          1922 1907.39956
2  1951          1657 1796.58182
3  1952          1278 1586.97699
4  1953           966 1272.93205
5  1954           798  978.50789
6  1955           717  792.21708
7  1956           596  691.34549
8  1957           515  582.55475
9  1958           482  499.85081
10 1959           414  456.57739
11 1960           325  398.97830
12 1961           316  322.75012
13 1962           296  298.05923
14 1963           251  278.08662
15 1964           230  242.20354
16 1965           222  218.80626
17 1966           187  207.31766
18 1967           176  180.48000
19 1968           197  166.19369
20 1969           167  176.13017
21 1970           156  158.94046
22 1971           209  147.04175
23 1972           206  177.59690
24 1973           190  185.29864
25 1974           182  176.90996
26 1975           199  169.30411
27 1976           140  178.33931
28 1977           101  140.47719
29 1978           173  103.86881
30 1979           177  140.62298
31 1980           162  155.61188
32 1981           178  150.19943
33 1982           178  159.15325
34 1983           161  161.75456
35 1984           166  151.16102
36 1985           138  151.62356
37 1986           166  132.85338
38 1987           157  146.24073
39 1988           151  144.31535
40 1989           162  139.80298
41 1990           136  145.76100
42 1991           120  130.02076
43 1992           142  115.07450
44 1993           172  125.53589
45 1994           140  147.66652
46 1995           138  133.24666
47 1996           127  128.13336
48 1997           105  119.37941
49 1998           118  102.05668
50 1999           120  106.23718
51 2000            91  108.74611
52 2001            87   89.69131
53 2002            72   82.27525
54 2003            72   70.08089
55 2004            78   67.00277
56 2005            70   70.09064
57 2006            76   65.65998
58 2007            54   68.40312
59 2008            51   54.09900
60 2009            62   48.61706
61 2010            54   54.30866
62 2011            36   50.71451
63 2012            34   37.15514
64 2013            38   32.68249
65 2014            34   34.15847
66 2015            36   31.92197
67 2016            29   32.63839
68 2017            23   28.10707
69 2018            28   22.81167
70 2019            20   24.79042
71 2020            32   19.91524
72 2021            20   26.27405
73 2022            17   20.24200</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_netherlands_1, <span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> number_deaths, <span class="at">color =</span> <span class="st">"Actual"</span>)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> exp_fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Actual vs Fitted TB Deaths in Netherlands with Arima(0,1,1)"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Number of Deaths"</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1000</span>) <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1980</span>,<span class="dv">2021</span>) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 31 rows containing missing values or values outside the scale range
(`geom_line()`).
Removed 31 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_forecast_netherlands_1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">time</span>(forecasted_netherlands_1<span class="sc">$</span>mean),</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">exp</span>(forecasted_netherlands_1<span class="sc">$</span>mean),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">exp</span>(forecasted_netherlands_1<span class="sc">$</span>lower[,<span class="dv">1</span>]),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">exp</span>(forecasted_netherlands_1<span class="sc">$</span>upper[,<span class="dv">1</span>])</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>df_forecast_netherlands_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year     mean    lower    upper
1 2023 16.73859 12.04252 26.91325
2 2024 15.69511 10.80856 24.91273
3 2025 14.71667  9.43030 24.92027</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> netherlands_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths, <span class="at">color =</span> <span class="st">"Actual"</span>)) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_forecast_netherlands_1, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean, <span class="at">color =</span> <span class="st">"Forecast"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df_forecast_netherlands_1, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Actual"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Forecast"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Number deaths"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Serie"</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2012</span>, <span class="dv">2024</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s study the second adjusted model for the Netherlands series.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>forecasted_netherlands_2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_netherlands_model_2,<span class="at">level =</span> <span class="fu">c</span>(<span class="dv">95</span>), <span class="at">h=</span><span class="dv">3</span>, <span class="at">bootstrap =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(forecasted_netherlands_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>exp_forecasted_netherlands_fitted_2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(forecasted_netherlands_2<span class="sc">$</span>fitted)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>data_netherlands_2 <span class="ot">&lt;-</span> netherlands_data <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exp_fitted =</span> exp_forecasted_netherlands_fitted_2) </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>data_netherlands_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year number_deaths exp_fitted
1  1950          1922   1907.522
2  1951          1657   1922.000
3  1952          1278   1657.000
4  1953           966   1278.000
5  1954           798    966.000
6  1955           717    798.000
7  1956           596    717.000
8  1957           515    596.000
9  1958           482    515.000
10 1959           414    482.000
11 1960           325    414.000
12 1961           316    325.000
13 1962           296    316.000
14 1963           251    296.000
15 1964           230    251.000
16 1965           222    230.000
17 1966           187    222.000
18 1967           176    187.000
19 1968           197    176.000
20 1969           167    197.000
21 1970           156    167.000
22 1971           209    156.000
23 1972           206    209.000
24 1973           190    206.000
25 1974           182    190.000
26 1975           199    182.000
27 1976           140    199.000
28 1977           101    140.000
29 1978           173    101.000
30 1979           177    173.000
31 1980           162    177.000
32 1981           178    162.000
33 1982           178    178.000
34 1983           161    178.000
35 1984           166    161.000
36 1985           138    166.000
37 1986           166    138.000
38 1987           157    166.000
39 1988           151    157.000
40 1989           162    151.000
41 1990           136    162.000
42 1991           120    136.000
43 1992           142    120.000
44 1993           172    142.000
45 1994           140    172.000
46 1995           138    140.000
47 1996           127    138.000
48 1997           105    127.000
49 1998           118    105.000
50 1999           120    118.000
51 2000            91    120.000
52 2001            87     91.000
53 2002            72     87.000
54 2003            72     72.000
55 2004            78     72.000
56 2005            70     78.000
57 2006            76     70.000
58 2007            54     76.000
59 2008            51     54.000
60 2009            62     51.000
61 2010            54     62.000
62 2011            36     54.000
63 2012            34     36.000
64 2013            38     34.000
65 2014            34     38.000
66 2015            36     34.000
67 2016            29     36.000
68 2017            23     29.000
69 2018            28     23.000
70 2019            20     28.000
71 2020            32     20.000
72 2021            20     32.000
73 2022            17     20.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_netherlands_2, <span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> number_deaths, <span class="at">color =</span> <span class="st">"Actual"</span>)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> exp_fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Actual vs Fitted TB Deaths in Netherlands with Arima(0,1,1)"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Number of Deaths"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1000</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1980</span>,<span class="dv">2021</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 31 rows containing missing values or values outside the scale range
(`geom_line()`).
Removed 31 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_forecast_netherlands_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">time</span>(forecasted_netherlands_2<span class="sc">$</span>mean),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">exp</span>(forecasted_netherlands_2<span class="sc">$</span>mean),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">exp</span>(forecasted_netherlands_2<span class="sc">$</span>lower[,<span class="dv">1</span>]),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">exp</span>(forecasted_netherlands_2<span class="sc">$</span>upper[,<span class="dv">1</span>])</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>df_forecast_netherlands_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year mean     lower    upper
1 2023   17 12.090385 24.29702
2 2024   17 10.937039 29.23548
3 2025   17  9.763207 32.75272</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> netherlands_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number_deaths, <span class="at">color =</span> <span class="st">"Actual"</span>)) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_forecast_netherlands_2, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean, <span class="at">color =</span> <span class="st">"Forecast"</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df_forecast_netherlands_2, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Actual"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"Forecast"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Forecast"</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Number deaths"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Serie"</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2012</span>, <span class="dv">2024</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TFG_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>